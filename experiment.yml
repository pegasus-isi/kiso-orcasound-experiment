name: kiso-orcasound-experiment

deployment:
  htcondor:
    - kind: central-manager
      labels:
        - central-manager

    - kind: execute
      labels:
        - execute

    - kind: submit
      labels:
        - submit

software:
  apptainer:
    labels:
      - execute

sites:
  - kind: vagrant
    backend: virtualbox
    box: bento/rockylinux-9
    user: vagrant
    config_extra: 'config.vm.synced_folder ".", "/vagrant", disabled: true'
    resources:
      machines:
        - labels:
            - submit
            - execute
            - central-manager
          backend: virtualbox
          box: bento/rockylinux-9
          user: vagrant
          number: 1
          flavour_desc:
            core: 16
            mem: 16384
      networks:
        - labels:
            - r1
          cidr: "172.16.42.0/16"

experiments:
  - kind: pegasus
    name: orcasound-experiment
    count: 1
    main: bin/main.sh
    submit_node_labels:
      - submit
    timeout: -1
    setup:
      - labels:
          - submit
        executable: /bin/bash
        script: |
          set -e
          sudo pip install numpy pandas
